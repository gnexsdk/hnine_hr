{% extends "base.html" %}

{% block title %}HINE - ë¶€ê³  ë©”ì¼ ë°œì†¡{% endblock %}
{% block page_title %}ë¶€ê³  ë©”ì¼ ë°œì†¡{% endblock %}

{% block content %}
<div class="rip-layout">
    <!-- ëª¨ë°”ì¼ íƒ­ ë²„íŠ¼ -->
    <div class="mobile-tabs">
        <button class="tab-btn active" onclick="switchTab('form')" id="tabForm">âœï¸ ì…ë ¥</button>
        <button class="tab-btn" onclick="switchTab('preview')" id="tabPreview">ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°</button>
    </div>

    <!-- Form Section -->
    <div class="card rip-panel" id="panelForm">
        <div class="card-header">
            <h3>âœ‰ï¸ ë¶€ê³  ì •ë³´ ì…ë ¥</h3>
        </div>
        <div class="card-body">
            <form name="ripForm" method="post" enctype="multipart/form-data" onsubmit="return validateForm()">
                <div class="form-row">
                    <div class="form-group">
                        <label>íŒ€/ì‹¤</label>
                        <input type="text" name="team" value="{{ form_data.team }}" required placeholder="ì˜ˆ: Visualì‹¤" autocomplete="off">
                    </div>
                    <div class="form-group">
                        <label>ì´ë¦„</label>
                        <input type="text" name="name" value="{{ form_data.name }}" required placeholder="ì§ì› ì´ë¦„" autocomplete="off">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>ê´€ê³„</label>
                        <input type="text" name="relation" value="{{ form_data.relation }}" required placeholder="ì˜ˆ: ì¡°ë¶€" autocomplete="off">
                    </div>
                    <div class="form-group">
                        <label>ê³ ì¸ëª…</label>
                        <input type="text" name="deceased" value="{{ form_data.deceased }}" required placeholder="ê³ ì¸ ì„±í•¨" autocomplete="off">
                    </div>
                </div>

                <div class="form-group">
                    <label>ë³„ì„¸ì¼</label>
                    <input type="text" name="date" value="{{ form_data.date }}" required placeholder="2024ë…„ 9ì›” 26ì¼ ëª©ìš”ì¼">
                </div>

                <div class="form-group">
                    <label>ë¹ˆì†Œ</label>
                    <input type="text" name="funeral_home" value="{{ form_data.funeral_home }}" required placeholder="ì¥ë¡€ì‹ì¥ ì´ë¦„">
                </div>

                <div class="form-group">
                    <label>ì£¼ì†Œ</label>
                    <input type="text" name="address" value="{{ form_data.address }}" required placeholder="ì¥ë¡€ì‹ì¥ ì£¼ì†Œ">
                </div>

                <div class="form-group">
                    <label>ë°œì¸</label>
                    <input type="text" name="final_date" value="{{ form_data.final_date }}" required placeholder="2024ë…„ 9ì›” 28ì¼ í† ìš”ì¼ ì˜¤ì „ 6ì‹œ00ë¶„">
                </div>

                <div class="form-group">
                    <label>ë¶€ê³  ê´€ë ¨ URL <span style="font-weight: 400; color: var(--slate-400);">(ì„ íƒì‚¬í•­)</span></label>
                    <input type="url" name="url" value="{{ form_data.url }}" placeholder="https://example.com">
                </div>

                <div class="rip-actions">
                    <button type="submit" class="btn btn-secondary btn-action" id="preview-btn">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                        ë¯¸ë¦¬ë³´ê¸°
                    </button>
                    <div class="send-buttons">
                        <button type="submit" name="send" value="test" class="btn btn-primary btn-action">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                            </svg>
                            í…ŒìŠ¤íŠ¸ ë°œì†¡
                        </button>
                        <button type="submit" name="send" value="all" class="btn btn-danger btn-action">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                                <polyline points="22,6 12,13 2,6"></polyline>
                            </svg>
                            ì „ì²´ ë°œì†¡
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Preview Section -->
    <div class="card rip-panel" id="panelPreview">
        <div class="card-header desktop-only">
            <h3>ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°</h3>
        </div>
        <div class="card-body preview-body">
            {% if preview_image %}
            <img src="data:image/png;base64,{{ preview_image }}" class="preview-img">
            {% else %}
            <div class="preview-empty">
                <svg width="56" height="56" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                    <polyline points="21 15 16 10 5 21"></polyline>
                </svg>
                <p class="preview-empty-title">ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</p>
                <p class="preview-empty-sub">ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ë¯¸ë¦¬ë³´ê¸°ë¥¼ í´ë¦­í•˜ì„¸ìš”</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
    function validateForm() {
        var requiredFields = [
            'team', 'name', 'relation', 'deceased',
            'date', 'funeral_home', 'address', 'final_date'
        ];

        for (var field of requiredFields) {
            if (!document.forms["ripForm"][field].value) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return false;
            }
        }

        var submitButton = document.activeElement;
        if (submitButton.name === 'send' && submitButton.value === 'all') {
            return confirm('ì „ì²´ êµ¬ì„±ì›ì—ê²Œ ë©”ì¼ì„ ë°œì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
        }

        return true;
    }

    function switchTab(tab) {
        var formPanel = document.getElementById('panelForm');
        var previewPanel = document.getElementById('panelPreview');
        var tabForm = document.getElementById('tabForm');
        var tabPreview = document.getElementById('tabPreview');

        if (tab === 'form') {
            formPanel.style.display = 'block';
            previewPanel.style.display = 'none';
            tabForm.classList.add('active');
            tabPreview.classList.remove('active');
        } else {
            formPanel.style.display = 'none';
            previewPanel.style.display = 'block';
            tabForm.classList.remove('active');
            tabPreview.classList.add('active');
        }
    }

    // ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ ëª¨ë°”ì¼ì—ì„œ ìë™ìœ¼ë¡œ ë¯¸ë¦¬ë³´ê¸° íƒ­ ì „í™˜
    {% if preview_image %}
    if (window.innerWidth <= 768) {
        switchTab('preview');
    }
    {% endif %}
</script>
{% endblock %}

{% block extra_styles %}
<style>
    .rip-layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
    }

    .mobile-tabs {
        display: none;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
    }

    .rip-actions {
        display: flex;
        gap: 12px;
        margin-top: 28px;
        flex-wrap: wrap;
        align-items: center;
    }

    .send-buttons {
        display: flex;
        gap: 12px;
    }

    .btn-action {
        white-space: nowrap;
    }

    .preview-body {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 400px;
    }

    .preview-img {
        max-width: 100%;
        border-radius: 8px;
        box-shadow: var(--shadow-md);
    }

    .preview-empty {
        text-align: center;
        color: var(--slate-400);
    }

    .preview-empty svg {
        margin-bottom: 16px;
    }

    .preview-empty-title {
        font-size: 14px;
        font-weight: 500;
    }

    .preview-empty-sub {
        font-size: 12px;
        margin-top: 4px;
    }

    .desktop-only {
        display: flex;
    }

    /* ===== ëª¨ë°”ì¼ ìµœì í™” ===== */
    @media (max-width: 768px) {
        .rip-layout {
            grid-template-columns: 1fr;
            gap: 0;
        }

        .mobile-tabs {
            display: flex;
            margin-bottom: 16px;
            background: var(--white);
            border-radius: 10px;
            padding: 4px;
            border: 1px solid var(--slate-200);
        }

        .tab-btn {
            flex: 1;
            padding: 12px 16px;
            border: none;
            background: transparent;
            font-family: inherit;
            font-size: 14px;
            font-weight: 500;
            color: var(--navy-600);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .tab-btn.active {
            background: var(--accent);
            color: white;
            box-shadow: 0 2px 8px rgba(59,130,246,0.25);
        }

        #panelPreview {
            display: none;
        }

        .desktop-only {
            display: none;
        }

        .preview-body {
            min-height: 300px;
        }

        .form-row {
            grid-template-columns: 1fr;
            gap: 0;
        }

        .rip-actions {
            flex-direction: column;
            gap: 10px;
            margin-top: 24px;
            padding-top: 20px;
            border-top: 1px solid var(--slate-200);
        }

        .rip-actions .btn-action {
            width: 100%;
            justify-content: center;
            padding: 16px;
            font-size: 15px;
            min-height: 52px;
        }

        .send-buttons {
            width: 100%;
            flex-direction: column;
            gap: 10px;
        }

        .send-buttons .btn-action {
            width: 100%;
        }
    }

    @media (max-width: 480px) {
        .rip-panel .card-body {
            padding: 16px;
        }
    }
</style>
{% endblock %}
